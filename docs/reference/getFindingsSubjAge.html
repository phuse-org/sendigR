<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Returns a data table with the set of findings rows included in the
findings where the age of subjects at finding time is within the
interval specified in fromAge to fromAge.
If the fromAge and fromAge are empty (null, na or empty
string), all rows from findings are returned."><title>Add the subject age at finding time - and optionally extract the set of
findings within a specified range of age. — getFindingsSubjAge • sendigR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add the subject age at finding time - and optionally extract the set of
findings within a specified range of age. — getFindingsSubjAge"><meta property="og:description" content="Returns a data table with the set of findings rows included in the
findings where the age of subjects at finding time is within the
interval specified in fromAge to fromAge.
If the fromAge and fromAge are empty (null, na or empty
string), all rows from findings are returned."><meta property="og:image" content="https://phuse-org.github.io/sendigR/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sendigR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Introduction.html">Introduction to sendigR</a>
    <a class="dropdown-item" href="../articles/SendDashboard.html">SendDashboard</a>
    <a class="dropdown-item" href="../articles/Usingxptcleaner.html">Using xptcleaner</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/phuse-org/sendigR/wiki/Resources">Resources</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/phuse-org/sendigR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add the subject age at finding time - and optionally extract the set of
findings within a specified range of age.</h1>
      <small class="dont-index">Source: <a href="https://github.com/phuse-org/sendigR/blob/HEAD/R/getFindingsSubjAge.R" class="external-link"><code>R/getFindingsSubjAge.R</code></a></small>
      <div class="d-none name"><code>getFindingsSubjAge.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Returns a data table with the set of findings rows included in the
<code>findings</code> where the age of subjects at finding time is within the
interval specified in <code>fromAge</code> to <code>fromAge</code>.<br>
If the <code>fromAge</code> and <code>fromAge</code> are empty (null, na or empty
string), all rows from <code>findings</code> are returned.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">getFindingsSubjAge</span><span class="op">(</span>
  <span class="va">dbToken</span>,
  <span class="va">findings</span>,
  <span class="va">animalList</span>,
  fromAge <span class="op">=</span> <span class="cn">NULL</span>,
  toAge <span class="op">=</span> <span class="cn">NULL</span>,
  inclUncertain <span class="op">=</span> <span class="cn">FALSE</span>,
  noFilterReportUncertain <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dbToken</dt>
<dd><p>Mandatory<br>
Token for the open database connection (see <code><a href="initEnvironment.html">initEnvironment</a></code>).</p></dd>
<dt>findings</dt>
<dd><p>Mandatory, data.table.<br>
A table with the set of input finding rows to process.<br>
The table must include at least columns named</p><ul><li><p><code>STUDYID</code></p></li>
<li><p><code>USUBJID</code></p></li>
<li><p><code>DOMAIN</code></p></li>
<li><p><code>[domain]SEQ</code></p></li>
<li><p><code>[domain]DY</code></p></li>
<li><p><code>[domain]DTC</code></p></li>
</ul><p>where <code>[domain]</code> is the name of the actual findings domain - e.g. <code>LBSEQ</code>, <code>LBDY</code>
and <code>LBDTC</code></p></dd>
<dt>animalList</dt>
<dd><p>Mandatory, data.table.<br>
A data with the set of animals included in the <code>findings</code> table
(may contain more animals than included in <code>findings</code>).<br>
The data set must contain at least these columns returned by the function <a href="getControlSubj.html">getControlSubj</a></p><ul><li><p><code>STUDYID</code></p></li>
<li><p><code>USUBJID</code></p></li>
<li><p><code>RFSTDTC</code></p></li>
<li><p><code>DM_AGEDAYS</code></p></li>
<li><p><code>NO_AGE_MSG</code></p></li>
</ul></dd>
<dt>fromAge</dt>
<dd><p>Optional, character <br>
The start of age interval to extract.<br>
Must be in a string in this format:<br><code>[value][age unit]</code> where <code>[age unit]</code> is one of</p><ul><li><p><code>d, day, days</code></p></li>
<li><p><code>w, week, weeks</code></p></li>
<li><p><code>m, month, months</code></p></li>
<li><p><code>y, year, years</code></p></li>
</ul><p>The unit is case-insensitive, space(s) between age value and unit is
allowed.</p></dd>
<dt>toAge</dt>
<dd><p>Optional. character <br>
The start of age interval to extract.<br>
Must be in a string in in the same format as described for <code>fromAge</code>.</p></dd>
<dt>inclUncertain</dt>
<dd><p>Mandatory, boolean.<br>
Only relevant if the <code>fromAge</code> and/or <code>toAge</code> is/are not empty.<br>
Indicates whether finding rows for which the age at finding time cannot be
confidently identified, shall be included or not in the output data table.</p></dd>
<dt>noFilterReportUncertain</dt>
<dd><p>Optional, boolean.<br>
Only relevant if the <code>fromAge</code> and <code>toAge</code> are empty.<br>
Indicates if the reason should be included if the age at finding time cannot
be confidently decided for an animal.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns a data.table with columns in this order:</p><ul><li><p>All columns contained in the <code>findings</code> input table (original
order except optional <code>UNCERTAIN_MSG</code> and <code>NOT_VALID_MSG</code>)</p></li>
<li><p><code>AGEDAYS</code>        (character)<br>
The subject age at finding time calculated in days. Is <code>NA</code> if thge age
cannot be confidently calculated.</p></li>
<li><p><code>UNCERTAIN_MSG</code>  (character)<br>
Included when parameter <code>inclUncertain=TRUE</code>.<br>
In case the age at finding time cannot be confidently matched during the
filtering of data, the column contains an indication of the reason.<br>
If any uncertainties have been identified for individual subjects included in
pools for pooled finding rows, one  message for is reported per pool/finding.<br>
Is NA for rows where the age at finding time can be confidently matched.<br>
A non-empty <code>UNCERTAIN_MSG</code> value generated by this function is merged with
non-empty <code>UNCERTAIN_MSG</code> values which may exist in the input set of findings
specified in <code>findings</code> - separated by '|'.</p></li>
<li><p><code>NOT_VALID_MSG</code> (character)<br>
Included when parameter <code>noFilterReportUncertain=TRUE</code>.<br>
In case the age at finding time cannot be confidently calculated, the column
contains an indication of the reason.<br>
Is NA for rows where age at finding time can be confidently calculated.<br>
A non-empty <code>NOT_VALID_MSG</code> value generated by this function is merged with
non-empty <code>NOT_VALID_MSG</code> values which may exist in the input set of findings
<code>findings</code> - separated by '|'.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In both situation, the subject age at finding time is calculated into an
additional column <code>AGEDAYS</code> for each row in <code>findings</code> combined
with the the additional input data.table <code>animalList</code> using this
algorithm:</p><ul><li><p>Determine the number of study days between study start and findings</p><ul><li><p>if <code>findings.[domain]DY</code> is populated</p><ul><li><p>If <code>findings.[domain]DY &gt; 0</code> then use
<code>findings.[domain]DY - 1</code></p></li>
<li><p>Else use <code>findings.[domain]DY</code></p></li>
</ul></li>
<li><p>Else If <code>findings.[domain]DTC</code> is populated compute
<code>animalList.RFSTDTC – findings.[domain]DTC</code> in days<br> where
<code>animalList.RFSTDTC</code> is each subject's reference start date
(<code>DM.RFSTDTC</code>)</p></li>
</ul></li>
<li><p>Animal age at time of finding is then calculated as
<code>animalList.AGEDAYS + [study days between study start and
        findings]</code><br>
where <code>animalList.AGEDAYS</code> is the  subject age at reference
start date(calculated during extraction of control subjects in
<code><a href="getControlSubj.html">getControlSubj</a></code>.</p></li>
<li><p>For pooled findings rows - i.e. POOLID is populated instead of
USUBJID - the animal age at time of finding is calculated per animal
included in the each pool and finding.</p><ul><li><p>If all calculated ages are equal within a pool and finding,
the calculated age is populated for this pool/finding.</p></li>
<li><p>If all calculated ages are within the same time internal
(2 days) within a pool and finding, the minimum calculated age
plus 1 day is populated for this pool/finding.</p></li>
</ul></li>
</ul><p>If both <code>fromAge</code> and <code>toAge</code> values are specified - all the rows
from the input table <code>findings</code> where value of the calculated
<code>AGEDYAS</code> is within the interval of the specified start/end age interval
are returned - including the values equal to the start/end age values.<br>
If only a <code>fromAge</code> value is specified - all the rows from the input
table <code>findings</code> where value of <code>AGEDYAS</code> equal to or greater than
the input age are returned.<br>
If only a <code>toAge</code> value is specified - all the rows from input table
<code>findings</code> where value of AGEDAYS is equal to or less than the input age
are extracted and returned.
The input age value(s) is/are converted to days before extraction of rows
from the input data tables using the input value(s) as filter - using this
conversion:</p><ul><li><p><code>DAYS</code></p></li>
<li><p><code>WEEKS   : value * 7</code></p></li>
<li><p><code>MONTHS  : value * 365/12</code></p></li>
<li><p><code>YEARS   : value * 365</code></p></li>
</ul><p>If input parameter <code>inclUncertain=TRUE</code>, findings rows where the age at
finding time cannot be confidently identified are included in the output set.
These uncertain situations are identified and reported (in column
UNCERTAIN_MSG):</p><ul><li><p>No age at reference time  has been calculated for subject
(<code>animalList.AGEDAYS</code>)</p></li>
<li><p>Reference start time  is missing or contains invalid ISO8601 date
value for subject (<code>animalList.RFSTDTC</code>).</p></li>
<li><p>Missing <code>[domain]DY</code> value and missing or invalid ISO8601 date
<code>[domain]DTC</code> value for finding</p></li>
<li><p>For pooled findings:</p><ul><li><p>More than two days between minimum and maximum of
<code>animalList.AGEDAYS</code> for the set of animals in a pool.</p></li>
<li><p>Different values in <code>animalList.RFSTDTC</code> for the set of
animals in a pool.</p></li>
</ul></li>
</ul><p>The same checks are performed and reported in column <code>NOT_VALID_MSG</code> if
<code>fromAge</code> and <code>fromAge</code> are empty and <code>noFilterReportUncertain
= TRUE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># Extract LB rows for the animals at age between 8 and 12 weeks at finding</span></span>
<span class="r-in"><span class="co"># time - include uncertain rows</span></span>
<span class="r-in"><span class="fu">getFindingsSubjAge</span><span class="op">(</span>dbToken <span class="op">=</span> <span class="va">db</span>,</span>
<span class="r-in">                   findings <span class="op">=</span> <span class="va">lb</span>,</span>
<span class="r-in">                   animalList <span class="op">=</span> <span class="va">animals</span>,</span>
<span class="r-in">                   fromAge <span class="op">=</span> <span class="st">'8w'</span>,</span>
<span class="r-in">                   toAge <span class="op">=</span> <span class="st">'12w'</span>,</span>
<span class="r-in">                   inclUncertain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># No filtering, just add AGEDAYS to FW rows - do not include messages when</span></span>
<span class="r-in"><span class="co"># the AGEDAYS cannot be confidently identified</span></span>
<span class="r-in"><span class="fu">getFindingsSubjAge</span><span class="op">(</span>dbToken <span class="op">=</span> <span class="va">db</span>, findings <span class="op">=</span> <span class="va">fw</span>,  animalList <span class="op">=</span> <span class="va">animals</span>,</span>
<span class="r-in">                   noFilterReportUncertain <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Bo Larsen, Yousuf Ali, Kevin Snyder, William Houser, Brianna Paisley, Cmsabbir Ahmed, Susan Butler, Michael Rosentreter, Michael Denieu, Wenxian Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

